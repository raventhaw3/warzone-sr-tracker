<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Warzone Ranked Tracker</title>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/countup.js@2.6.2/dist/countUp.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tsparticles"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<!-- Firebase core -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body {
  background: #000;
  color: #0ff;
  font-family: Arial, sans-serif;
  margin: 0;
  text-align: center;
  text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
}
#tsparticles {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: -1;
  opacity: 0.3;
}
h1,h2 { text-shadow: 0 0 8px #0ff, 0 0 16px #0ff; }
form {
  background: rgba(30,30,30,0.9);
  padding: 15px;
  border-radius: 10px;
  margin: 20px auto;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  max-width: 800px;
  box-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
}
input, select, button {
  padding: 10px;
  border: none;
  border-radius: 5px;
  background: rgba(0,0,0,0.8);
  color: #0ff;
  box-shadow: 0 0 5px #0ff;
  font-weight: bold;
}
button {
  background: #0ff;
  color: #000;
  cursor: pointer;
}
button:hover {
  background: #33ffff;
  box-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
}
.stats {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
}
.stat-card {
  background: rgba(20,20,20,0.9);
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
  min-width: 120px;
}
.rank-bar-container {
  margin: 20px auto;
  width: 90%;
  max-width: 800px;
  height: 40px;
  background: #111;
  border-radius: 8px;
  overflow: hidden;
  position: relative;
  box-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
}
#rankProgressBar {
  width: 0%;
  height: 100%;
  background: #0ff;
  position: relative;
  z-index: 1;
  box-shadow: 0 0 10px #0ff inset;
}
#rankProgressBar::after {
  content: '';
  position: absolute;
  width: 50px;
  height: 100%;
  top: 0;
  left: -50px;
  background: rgba(255,255,255,0.2);
  transform: skewX(-25deg);
  animation: ripple 1s linear infinite;
}
@keyframes ripple { 0% { left:-50px; } 100% { left:100%; } }
.rank-overlay {
  display: flex;
  justify-content: space-between;
  max-width: 900px;
  margin: 10px auto 30px auto;
  font-weight: bold;
  font-size: 16px;
}
.rank-overlay span {
  font-size: 18px;
  text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
}
#rankUpFlash {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 3rem;
  color: #fff;
  text-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
  display: none;
  z-index: 100;
}
@media(max-width:600px){
  form { flex-direction: column; gap: 8px; }
  input, select, button { width: 90%; font-size: 14px; }
  .stat-card { min-width: 100px; font-size: 14px; }
  .rank-overlay { font-size: 14px; flex-direction: column; gap: 5px; }
}
</style>
</head>
<body>

<div id="tsparticles"></div>

<h1>Warzone Ranked Tracker</h1>

<!-- Authentication -->
<form id="authForm">
  <input type="email" id="email" placeholder="Email" required />
  <input type="password" id="password" placeholder="Password" required />
  <button type="submit" id="loginBtn">Login / Register</button>
</form>

<form id="profileForm" style="display:none;">
  <input id="gamertag" placeholder="Gamertag" />
  <input id="sr" type="number" placeholder="Current SR" />
  <input id="wins" type="number" placeholder="Wins" />
  <input id="matches" type="number" placeholder="Matches" />
  <input id="kills" type="number" placeholder="Kills" />
  <input id="deaths" type="number" placeholder="Deaths" />
  <button type="submit">Save Profile</button>
  <button type="button" id="resetBtn">Reset</button>
</form>

<h2>Add Match</h2>
<form id="addMatchForm" style="display:none;">
  <input id="srGain" type="number" placeholder="SR Gained" />
  <input id="newKills" type="number" placeholder="Kills" />
  <input id="newDeaths" type="number" placeholder="Deaths" />
  <select id="newWin">
    <option value="yes">Win</option>
    <option value="no">Loss</option>
  </select>
  <button type="submit">Add Match</button>
</form>

<div class="stats" style="display:none;">
  <div class="stat-card">SR: <span id="srCounter">0</span></div>
  <div class="stat-card">K/D: <span id="kdCounter">0</span></div>
  <div class="stat-card">Win Rate: <span id="winRateCounter">0%</span></div>
</div>

<div class="rank-bar-container" style="display:none;">
  <div id="rankProgressBar"></div>
</div>

<div class="rank-overlay" style="display:none;">
  <span id="currentRank">Bronze 1</span>
  <span id="srLeft">1000 SR to next rank</span>
  <span id="nextRank">Bronze 2</span>
</div>

<div id="rankUpFlash">RANK UP!</div>

<script>
// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "AIzaSyDoxF823Ik1kW92fc4o5jUN8x6fWXlTJNg",
  authDomain: "warzone-46afd.firebaseapp.com",
  projectId: "warzone-46afd",
  storageBucket: "warzone-46afd.firebasestorage.app",
  messagingSenderId: "678583817891",
  appId: "1:678583817891:web:640c1bfd4e50414169d116"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// --- Particles ---
tsParticles.load("tsparticles", {
  fpsLimit:60,
  background:{color:"#000"},
  particles:{
    number:{value:50},
    color:{value:["#0ff","#0f0","#ffa500","#f0f","#ff0"]},
    shape:{type:"circle"},
    opacity:{value:0.5, random:{enable:true, minimumValue:0.3}},
    size:{value:3, random:{enable:true, minimumValue:1.5}},
    move:{enable:true, speed:0.8, random:true, outModes:{default:"out"}},
    links:{enable:true, distance:120, color:"#0ff", opacity:0.1, width:1}
  },
  interactivity:{
    events:{onHover:{enable:true, mode:"grab"}, onClick:{enable:true, mode:"push"}},
    modes:{grab:{distance:150, links:{opacity:0.3}}, push:{quantity:4}}
  },
  detectRetina:true
});

// --- Ranks ---
const ranks = ['Bronze 1','Bronze 2','Bronze 3','Silver 1','Silver 2','Silver 3','Gold 1','Gold 2','Gold 3','Platinum 1','Platinum 2','Platinum 3','Diamond 1','Diamond 2','Diamond 3','Iridescent','Top 250'];
const rankColors = {'Bronze 1':'#b87333','Bronze 2':'#b87333','Bronze 3':'#b87333','Silver 1':'#c0c0c0','Silver 2':'#c0c0c0','Silver 3':'#c0c0c0','Gold 1':'#ffd700','Gold 2':'#ffd700','Gold 3':'#ffd700','Platinum 1':'#00ffff','Platinum 2':'#00ffff','Platinum 3':'#00ffff','Diamond 1':'#1e90ff','Diamond 2':'#1e90ff','Diamond 3':'#1e90ff','Iridescent':'#ff00ff','Top 250':'#ff0000'};

let player = {gamertag:'',sr:0,wins:0,matches:0,kills:0,deaths:0};
const srCounter = new countUp.CountUp('srCounter',0,{duration:1});
const kdCounter = new countUp.CountUp('kdCounter',0,{duration:1,decimalPlaces:2});
const winRateCounter = new countUp.CountUp('winRateCounter',0,{duration:1,suffix:'%',decimalPlaces:1});

// --- Auth ---
const authForm = document.getElementById('authForm');
authForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  try {
    const userCredential = await auth.signInWithEmailAndPassword(email,password)
      .catch(async err=>{
        if(err.code==='auth/user-not-found'){
          await auth.createUserWithEmailAndPassword(email,password);
        } else {throw err;}
      });
    authForm.style.display='none';
    document.getElementById('profileForm').style.display='flex';
    document.getElementById('addMatchForm').style.display='flex';
    document.querySelector('.stats').style.display='flex';
    document.querySelector('.rank-bar-container').style.display='block';
    document.querySelector('.rank-overlay').style.display='flex';
    loadPlayer();
  } catch(err){ alert(err.message); }
});

// --- Firestore ---
function savePlayer(){
  const uid = auth.currentUser.uid;
  db.collection('players').doc(uid).set(player);
}
async function loadPlayer(){
  const uid = auth.currentUser.uid;
  const doc = await db.collection('players').doc(uid).get();
  if(doc.exists) player = doc.data();
  updateUI();
}
function resetPlayer(){
  const uid = auth.currentUser.uid;
  db.collection('players').doc(uid).delete();
  player={gamertag:'',sr:0,wins:0,matches:0,kills:0,deaths:0};
  updateUI();
}

// --- Rank & UI ---
function showRankUp(){const flash=document.getElementById('rankUpFlash'); flash.style.display='block'; gsap.fromTo(flash,{scale:0,opacity:0},{scale:1.5,opacity:1,duration:0.5,yoyo:true,repeat:1}); setTimeout(()=>flash.style.display='none',1500);}
function updateRankDisplay(sr, oldIndex=0){
  const currentEl=document.getElementById('currentRank');
  const nextEl=document.getElementById('nextRank');
  const srLeftEl=document.getElementById('srLeft');
  const bar=document.getElementById('rankProgressBar');

  let idx=Math.floor(sr/1000);
  if(idx>=ranks.length-1) idx=ranks.length-1;
  const nextRank=ranks[idx+1]||'Max';
  const startSR=idx*1000;
  const progress=((sr-startSR)/1000)*100;
  const left=Math.max((startSR+1000)-sr,0);

  currentEl.textContent=ranks[idx];
  nextEl.textContent=nextRank;
  srLeftEl.textContent=`${left} SR to next rank`;

  currentEl.style.color=rankColors[ranks[idx]];
  currentEl.style.textShadow=`0 0 5px ${rankColors[ranks[idx]]},0 0 10px ${rankColors[ranks[idx]]}`;
  nextEl.style.color=rankColors[nextRank]||'#0ff';
  nextEl.style.textShadow=`0 0 5px ${rankColors[nextRank]||'#0ff'},0 0 10px ${rankColors[nextRank]||'#0ff'}`;

  gsap.to(bar,{width:`${progress}%`,backgroundColor:rankColors[ranks[idx]],duration:1});
  if(idx>oldIndex) showRankUp();
}
function updateUI(){
  srCounter.update(player.sr);
  const kd=player.deaths?player.kills/player.deaths:player.kills;
  kdCounter.update(kd);
  const winRate=player.matches?(player.wins/player.matches*100):0;
  winRateCounter.update(winRate);
  updateRankDisplay(player.sr);
}

// --- Profile Form ---
document.getElementById('profileForm').addEventListener('submit',e=>{
  e.preventDefault();
  player.gamertag=document.getElementById('gamertag').value;
  player.sr=parseInt(document.getElementById('sr').value)||0;
  player.wins=parseInt(document.getElementById('wins').value)||0;
  player.matches=parseInt(document.getElementById('matches').value)||0;
  player.kills=parseInt(document.getElementById('kills').value)||0;
  player.deaths=parseInt(document.getElementById('deaths').value)||0;
  savePlayer(); updateUI();
});
document.getElementById('resetBtn').addEventListener('click',resetPlayer);

// --- Add Match Form ---
document.getElementById('addMatchForm').addEventListener('submit',e=>{
  e.preventDefault();
  const oldSR=player.sr;
  const gain=parseInt(document.getElementById('srGain').value)||0;
  player.sr+=gain;
  player.kills+=parseInt(document.getElementById('newKills').value)||0;
  player.deaths+=parseInt(document.getElementById('newDeaths').value)||0;
  player.matches+=1;
  if(document.getElementById('newWin').value==='yes') player.wins+=1;
  savePlayer(); updateUI(); updateRankDisplay(player.sr,Math.floor(oldSR/1000));
});
</script>
</body>
</html>
